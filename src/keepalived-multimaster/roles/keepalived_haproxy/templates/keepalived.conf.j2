global_defs {
   router_id LVS_DEVEL
}

vrrp_script haproxy_check {
   script "killall -0 haproxy"
   interval 2
   weight 2 
}

vrrp_instance OCP_EXT {
   interface {{ external_interface }}{% if external_vlan is defined %}.{{ external_vlan }}{% endif %}

   virtual_router_id 51

   priority {% for lb in play_hosts %}{% if inventory_hostname==lb %}{{ keepalived_priority_start - loop.index * 2 }}{% endif %}{% endfor %}



   state {% if groups.lb.index(inventory_hostname) == 0 %} {{ "MASTER" }}{% else %} {{ "BACKUP" }}{% endif %}


   virtual_ipaddress {
       {{ openshift_master_cluster_public_ip }} dev {{ external_interface }}{% if external_vlan is defined %}.{{ external_vlan }}{% endif %}

   }
   track_script {
       haproxy_check
   }
   authentication {
      auth_type PASS
      auth_pass {{ keepalived_external_pass.stdout }}
   }
}

vrrp_instance OCP_INT {
   interface {{ internal_interface }}{% if internal_vlan is defined %}.{{ internal_vlan }}{% endif %}
   
   virtual_router_id 91
   
   priority {% for lb in play_hosts %}{% if inventory_hostname==lb %}{{ keepalived_priority_start - loop.index * 2 }}{% endif %}{% endfor %}



   state {% if groups.lb.index(inventory_hostname) == 0 %} {{ "MASTER" }}{% else %} {{ "BACKUP" }}{% endif %}


   virtual_ipaddress {
       {{ openshift_master_cluster_ip }} dev {{ internal_interface }}{% if internal_vlan is defined %}.{{ internal_vlan }}{% endif %}
   
   }
   track_script {
       haproxy_check
   }
   authentication {
      auth_type PASS
      auth_pass {{ keepalived_internal_pass.stdout }}
   }
}

